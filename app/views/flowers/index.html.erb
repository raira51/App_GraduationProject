<div class="min-h-screen w-full overflow-auto bg-stone-50">
  <div class="mx-auto max-w-5xl px-4 py-10">
    <div class="mx-auto max-w-md">

      <div class="mb-6">
        <%= link_to edit_celebration_path(@celebration),
              class: "inline-flex items-center gap-2 text-sm text-stone-500 hover:text-stone-700" do %>
          <span>←</span>
          <span>戻る</span>
        <% end %>
      </div>

      <div class="rounded-2xl border border-stone-200 bg-white p-8 shadow-sm">
        <div class="mb-6">
          <h1 class="text-2xl font-bold tracking-tight">花束作成画面</h1>
          <p class="mt-2 text-sm text-stone-600">
            花名・花言葉を検索する / 花一覧から選択する
          </p>
        </div>

        <% if flash[:notice] %>
          <div class="mb-4 rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-700">
            <%= flash[:notice] %>
          </div>
        <% end %>

        <% if flash[:alert] %>
          <div class="mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700">
            <ul class="list-disc pl-5 space-y-1">
              <% Array(flash[:alert]).each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- 検索フォーム -->
        <%= form_with url: celebration_flowers_path(@celebration), method: :get, class: "space-y-3" do %>
          <div>
            <%= label_tag :q, "花名･花言葉を検索する",
                  class: "block text-sm font-medium text-stone-700" %>

            <div class="mt-2 flex gap-2">
              <%= text_field_tag :q, @q,
                    class: "w-full rounded-xl border border-stone-300 px-4 py-3",
                    placeholder: "検索例：愛、思いやり、ひまわり、バラ" %>

              <%= submit_tag "検索",
                    class: "shrink-0 rounded-xl border border-stone-200 bg-white px-4 py-3 text-sm font-semibold hover:bg-stone-50" %>
            </div>
          </div>

          <% if @q.present? %>
            <div class="flex items-center justify-between">
              <p class="text-xs text-stone-500">
                検索ワード：<span class="font-semibold text-stone-700"><%= @q %></span>
              </p>

              <%= link_to "クリア",
                    celebration_flowers_path(@celebration),
                    class: "text-xs font-semibold text-stone-500 hover:text-stone-700" %>
            </div>
          <% end %>
        <% end %>

        <div class="mt-6 border-t border-stone-100 pt-6">
          <h2 class="text-sm font-semibold text-stone-800">
            <%= @q.present? ? "検索結果" : "花一覧" %>
          </h2>

          <% if @flowers.any? %>
            <div class="mt-4 grid grid-cols-3 gap-3">
              <% @flowers.each do |flower| %>
                <div class="rounded-2xl border border-stone-200 bg-white p-3">
                  <!-- 画像 -->
                  <div class="flex h-24 w-full items-center justify-center rounded-xl border bg-stone-50">
                    <%= image_tag flower_image_path_for(flower),
                          class: "h-16 w-16 object-contain" %>
                  </div>

                  <!-- 花名 -->
                  <div class="mt-2 text-xs text-stone-600">
                    花名：<span class="font-semibold text-stone-800"><%= flower.name %></span>
                  </div>

                  <!-- 花言葉（word で統一） -->
                  <% if flower.word.present? %>
                    <div class="mt-1 text-[11px] text-stone-500">
                      花言葉：<%= flower.word %>
                    </div>
                  <% else %>
                    <div class="mt-1 text-[11px] text-stone-400">
                      花言葉：-
                    </div>
                  <% end %>

                  <!-- 選択 -->
                  <%= button_to "選択",
                        celebration_bouquet_flowers_path(@celebration),
                        method: :post,
                        params: { flower_id: flower.id },
                        class: "mt-3 w-full rounded-lg border border-stone-200 bg-white px-2 py-2 text-xs font-semibold hover:bg-stone-50" %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="mt-3 text-sm text-stone-500">該当する花が見つかりませんでした。</p>
          <% end %>

          <div class="mt-6">
            <%= link_to "戻る",
                  edit_celebration_path(@celebration),
                  class: "block w-full rounded-xl border border-stone-200 bg-white px-4 py-2 text-center text-sm font-semibold hover:bg-stone-50" %>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

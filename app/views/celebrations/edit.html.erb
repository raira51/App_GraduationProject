<div class="min-h-screen w-full overflow-auto bg-stone-50">
  <div class="mx-auto max-w-5xl px-4 py-10">
    <div class="mx-auto max-w-md">
      <div class="mb-6">
        <%= link_to mypage_path,
              class: "inline-flex items-center gap-2 text-sm text-stone-500 hover:text-stone-700" do %>
          <span>←</span>
          <span>戻る</span>
        <% end %>
      </div>

      <div class="rounded-2xl border border-stone-200 bg-white p-8 shadow-sm">
        <div class="mb-6">
          <h1 class="text-2xl font-bold tracking-tight">お祝いルーム作成</h1>
          <p class="mt-2 text-sm text-stone-600">
            必要事項を入力して作成します。
          </p>
        </div>

        <% if flash[:notice] %>
          <div class="mb-4 rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-sm text-emerald-700">
            <%= flash[:notice] %>
          </div>
        <% end %>

        <% if flash[:alert] %>
          <div class="mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700">
            <ul class="list-disc pl-5 space-y-1">
              <% Array(flash[:alert]).each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%= form_with model: @celebration, class: "space-y-5" do |f| %>

          <!-- タイトル -->
          <div>
            <%= f.label :title, "お祝いルームの名前*",
                  class: "block text-sm mt-4 font-medium text-stone-700" %>
            <%= f.text_field :title,
                  class: "mt-1 w-full rounded-xl border border-stone-300 px-4 py-3",
                  placeholder: "例：○○高校卒業" %>
          </div>

          <!-- 日付 -->
          <div>
            <%= f.label :celebration_date, "お祝いする日付",
                  class: "block text-sm mt-4 font-medium text-stone-700" %>
            <%= f.date_field :celebration_date,
                  value: (f.object.celebration_date&.strftime("%Y-%m-%d")),
                  class: "mt-1 w-full rounded-xl border border-stone-300 px-4 py-3 bg-white" %>
          </div>

          <!-- お祝いする人 -->
          <div>
            <%= f.label :giver_name, "お祝いする人*",
                  class: "block text-sm mt-4 font-medium text-stone-700" %>
            <%= f.text_field :giver_name,
                  class: "mt-1 w-full rounded-xl border border-stone-300 px-4 py-3",
                  placeholder: "例：○○部のみんな" %>
          </div>

          <!-- お祝いされる人 -->
          <div>
            <%= f.label :receiver_name, "お祝いされる人*",
                  class: "block text-sm mt-4 font-medium text-stone-700" %>
            <%= f.text_field :receiver_name,
                  class: "mt-1 w-full rounded-xl border border-stone-300 px-4 py-3",
                  placeholder: "例：○○先輩" %>
          </div>

          <!-- 一言 -->
          <div>
            <%= f.label :short_message, "お祝いの一言",
                  class: "block text-sm mt-4 font-medium text-stone-700" %>
            <%= f.text_field :short_message,
                  class: "mt-1 w-full rounded-xl border border-stone-300 px-4 py-3",
                  placeholder: "例：卒業おめでとうございます！" %>
          </div>

          <!-- メッセージ -->
          <div>
            <p class="text-sm mt-4 font-medium text-stone-700">メッセージを書く*</p>

            <div class="mt-3 flex flex-col items-center gap-2">
              <div class="flex h-20 w-20 items-center justify-center">
                <%= image_tag letter_icon_path_for(@celebration),class: "h-20 w-20 object-contain" %>
              </div>

              <div class="flex flex-wrap items-center justify-center gap-2">
                <span class="rounded-full border px-2 py-1 text-[11px] text-stone-600">
                  <%= @celebration.letters.count %>件
                </span>
            
                <!-- 仮置き -->
                <span class="rounded-full border border-emerald-200 bg-emerald-50 px-2 py-1 text-[11px] text-emerald-700">
                  募集中
                </span>
              </div>
            </div>

            <%= link_to "/l/#{@celebration.share_url}",
              class: "mt-3 block w-full rounded-xl border border-stone-200 bg-white px-4 py-2 text-center text-sm font-semibold hover:bg-stone-50" do %>
              メッセージ入力フォームを開く
            <% end %>
          </div>

          <!-- 花束 -->
          <div>
            <p class="text-sm mt-4 font-medium text-stone-700">花束をつくる*</p>

            <div class="mt-3 flex flex-col items-center gap-2">
              <div class="h-24 w-24 overflow-hidden rounded-xl bg-stone-50">
                <%= image_tag bouquet_image_path_for(@celebration),class: "h-full w-full object-contain" %>
              </div>
                <% if @celebration.bouquet&.bouquet_flowers&.any? %>
                  <p class="text-sl text-emerald-700">選択済み：<%= bouquet_main_flower_name_for(@celebration) %></p>
                <% else %>
                  <p class="text-sl text-stone-500">未選択</p>
                <% end %>
            </div>
            
            <%= link_to celebration_flowers_path(@celebration),
              class: "mt-3 block w-full rounded-xl border border-stone-200 bg-white px-4 py-2 text-center text-sm font-semibold hover:bg-stone-50" do %>
              花検索フォームを開く
            <% end %>
          </div>

          <!-- 背景 -->
          <div>
            <p class="text-sm mt-4 font-medium text-stone-700">背景パターンの選択*</p>
            <div class="mt-2 grid grid-cols-3 gap-3">
              <% 6.times do %>
                <div class="aspect-square rounded-xl border bg-stone-50"></div>
              <% end %>
            </div>
          </div>

          <!-- 合言葉 -->
          <div>
            <%= f.label :view_password, "閲覧用の合言葉(6文字以内)",
                  class: "block text-sm mt-4 font-medium text-stone-700" %>
            <%= f.text_field :view_password,
                  class: "mt-1 w-full rounded-xl border border-stone-300 px-4 py-3",
                  placeholder: "例：ありがとう",autocomplete: "off" %>
          </div>

          <!-- 作成 -->
        <div class="mt-4">
          <%= f.submit "一時保存する",
                class: "block w-full rounded-xl bg-teal-700 px-6 py-3 text-center text-sm font-semibold text-white shadow-[0_4px_0_#115e59] transition-all duration-150 hover:bg-teal-600 active:translate-y-[3px] active:scale-[0.98] active:shadow-none" %>
        </div>
        <% end %>

        <div class="mt-4">
          <% unless @celebration.published? %>
           <%= button_to "内容を確定する（※ 確定後、変更不可）",
                publish_celebration_path(@celebration),
                method: :patch,
                form: { data: { turbo: false } },
                class: "block w-full rounded-xl bg-teal-700 px-6 py-3 text-center text-sm font-semibold text-white shadow-[0_4px_0_#115e59] transition-all duration-150 hover:bg-teal-600 active:translate-y-[3px] active:scale-[0.98] active:shadow-none" %>
              <% else %>
                <p class="text-center text-sm text-stone-500">このお祝いルームは確定済みです</p>
          <% end %>
          </div>

          <p class="mt-4 text-center text-sm text-stone-500">
            作成後、閲覧用URLが発行されます
          </p>
      </div>
    </div>
  </div>
</div>